{% extends "fz_intbase.html" %}
{% block content %}

<div class="panel panel-success">
	<div class="panel-body">
		<div class="row">
			<div class="col-xs-4">
			<div class="alert alert-warning" role="alert">默认结果是当天生成的<br>测试时间：每天下午3点到4点，一共测试5次</div>
				<form class="form-horizontal" role="form" method="get">
					<div class="form-group">
						<label for="dtp_input2" class="col-sm-4 control-label">开始时间</label>
						<div class="col-sm-8 input-group date form_date" data-date="" data-date-format="dd MM yyyy" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
							<input name="from_date" class="form-control" size="16" type="text" value="" readonly>
							<span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
						</div><input type="hidden" id="dtp_input2" value="" />
					</div>
					<div class="form-group">
						<label for="dtp_input2" class="col-sm-4 control-label">结束时间</label>
						<div class="col-sm-8 input-group date form_date" data-date="" data-date-format="dd MM yyyy" data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
							<input name="to_date" class="form-control" size="16" type="text" value="" readonly>
							<span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>
						</div>
						<input type="hidden" id="dtp_input2" value="" />
					</div>
					<div class="form-group">
						<div class="col-sm-offset-4 col-sm-8">
							<button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search"></span> 查询</button>
						</div>
					</div>
				</form>
			</div>
			<div class="col-xs-8">
				<div id="canvas-holder">
					<canvas id="chart-area" /></canvas>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="panel panel-success">
	<div class="panel-heading"><span class="glyphicon glyphicon-stats"></span> 仿真环境  接口错误列表</div>
</div>

<ul class="nav nav-pills nav-justified" role="tablist">
	<li role="presentation" class="active"><a href="#auto200" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-remove"></span> code返回非1<span class="badge"> {{ err_200|length}}</span></a></li>
	<li role="presentation"><a href="#auto500" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-tasks"></span> 500错误<span class="badge"> {{ err_500|length}}</span></a></li>
	<li role="presentation"><a href="#auto404" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-star"></span> 404错误<span class="badge"> {{ err_404|length}}</span></a></li>
</ul>
<div class="tab-content">

	<div role="tabpanel" class="tab-pane fade in active" id="auto200"><br />
			<div class="panel panel-default">
				<div class="panel-heading">错误汇总</div>
				<div class="panel-body">
					<table class="table table-hover table-condensed ">
					<thead><tr class="info"><th class="col-sm-1">HTTPCode</th><th class="col-sm-1">LogCode</th><th class="col-sm-2">接口</th><th class="col-sm-1">描述</th><th class="col-sm-1">URL</th><th class="col-sm-2">DebugMsg</th><th class="col-sm-1">Error</th><th class="col-sm-1">Message</th><th class="col-sm-1">Time</th></tr></thead>
					{% for v in err_200 %}
					<tr><th>{{ v.code }}</th><th>{{ v.log_code }}</th><th style="word-break:break-all">{{ v.method_version }}</th><th>{{ v.name }}</th><th><a href="{{ v.url }}" target="_blank">URL</a></th><th  style="word-break:break-all">{{ v.debugmsg }}</th><th  style="word-break:break-all">{{ v.error }}</th><th  style="word-break:break-all">{{ v.message }}</th><th  style="word-break:break-all">{{ v.timestamp|date:"Y-m-d H:i" }}</th></tr>
					{% endfor %}
					</table>
				</div>
			</div>
	</div>
	<div role="tabpanel" class="tab-pane fade" id="auto500"><br />
			<div class="panel panel-default">
				<div class="panel-heading">错误汇总</div>
				<div class="panel-body">
					<table class="table table-hover table-condensed ">
					<thead><tr class="info"><th class="col-sm-0.5">HTTPCode</th><th class="col-sm-0.5">LogCode</th><th class="col-sm-1.5">接口</th><th class="col-sm-1.5">描述</th><th class="col-sm-0.5">URL</th><th class="col-sm-2">DebugMsg</th><th class="col-sm-2">Error</th><th class="col-sm-2">Message</th><th class="col-sm-1.5">Time</th></tr></thead>
					{% for v in err_500 %}
					<tr><th>{{ v.code }}</th><th>{{ v.log_code }}</th><th style="word-break:break-all">{{ v.method_version }}</th><th>{{ v.name }}</th><th><a href="{{ v.url }}" target="_blank">URL</a></th><th>{{ v.debugmsg }}</th><th>{{ v.error }}</th><th>{{ v.message }}</th><th>{{ v.timestamp|date:"Y-m-d H:i" }}</th></tr>
					{% endfor %}
					</table>
				</div>
			</div>
	</div>
	<div role="tabpanel" class="tab-pane fade" id="auto404"><br />
			<div class="panel panel-default">
				<div class="panel-heading">错误汇总</div>
				<div class="panel-body">
					<table class="table table-hover table-condensed ">
					<thead><tr class="info"><th class="col-sm-0.5">HTTPCode</th><th class="col-sm-0.5">LogCode</th><th class="col-sm-1.5">接口</th><th class="col-sm-1.5">描述</th><th class="col-sm-0.5">URL</th><th class="col-sm-2">DebugMsg</th><th class="col-sm-2">Error</th><th class="col-sm-2">Message</th><th class="col-sm-1.5">Time</th></tr></thead>
					{% for v in err_404 %}
					<tr><th>{{ v.code }}</th><th>{{ v.log_code }}</th><th style="word-break:break-all">{{ v.method_version }}</th><th>{{ v.name }}</th><th><a href="{{ v.url }}" target="_blank">URL</a></th><th>{{ v.debugmsg }}</th><th>{{ v.error }}</th><th>{{ v.message }}</th><th>{{ v.timestamp|date:"Y-m-d H:i" }}</th></tr>
					{% endfor %}
					</table>
				</div>
			</div>
	</div>
</div>
    <script>
	var succ_dict = {{ succ_dict|safe }};

    var config = {
        data: {
            datasets: [{
                data: [
					succ_dict['code500'],succ_dict['code404'],succ_dict['code1'],succ_dict['codenot1'],succ_dict['other']
                ],
                backgroundColor: [
                    "#F7464A",
                    "#FDB45C",
                    "#46BFBD",
                    "#949FB1",
                    "#4D5360",
                ],
                label: 'My dataset' // for legend
            }],
            labels: [
                "500",
                "404",
                "code=1",
                "code≠1",
                "other"
            ]
        },
        options: {
            responsive: true,
            legend: {
                position: 'right',
            },
            title: {
                display: true,
                text: '响应码分布图',
				position: 'bottom'
            },
            scale: {
              ticks: {
                beginAtZero: true
              },
              reverse: false
            },
            animation: {
                animateRotate: false,
                animateScale: true
            }
        }
    };

    window.onload = function() {
        var ctx = document.getElementById("chart-area");
        window.myPolarArea = Chart.PolarArea(ctx, config);
    };

    </script>
{% endblock %}
